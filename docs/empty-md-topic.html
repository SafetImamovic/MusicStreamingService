<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-05-18T23:08:35.6349687"><title>Integracija Supabase-a s TypeScript Tipovima | Music Streaming Service</title><script type="application/json" id="virtual-toc-data">[{"id":"korak-1-instalacija-supabase-cli-a","level":0,"title":"Korak 1: Instalacija Supabase CLI-a","anchor":"#korak-1-instalacija-supabase-cli-a"},{"id":"korak-2-prijava-u-supabase","level":0,"title":"Korak 2: Prijava u Supabase","anchor":"#korak-2-prijava-u-supabase"},{"id":"korak-3-generisanje-typescript-tipova","level":0,"title":"Korak 3: Generisanje TypeScript tipova","anchor":"#korak-3-generisanje-typescript-tipova"},{"id":"korak-4-postavljanje-supabase-i-user-context-providera","level":0,"title":"Korak 4: Postavljanje Supabase i User Context Providera","anchor":"#korak-4-postavljanje-supabase-i-user-context-providera"},{"id":"korak-5-postavljanje-user-context-a","level":0,"title":"Korak 5: Postavljanje User Context-a","anchor":"#korak-5-postavljanje-user-context-a"},{"id":"korak-6-instalacija-stripe-a","level":0,"title":"Korak 6: Instalacija Stripe-a","anchor":"#korak-6-instalacija-stripe-a"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Integracija Supabase-a s TypeScript Tipovima | Music Streaming Service"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Music Streaming Service Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/empty-md-topic.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Integracija Supabase-a s TypeScript Tipovima | Music Streaming Service"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/empty-md-topic.html#webpage",
    "url": "writerside-documentation/empty-md-topic.html",
    "name": "Integracija Supabase-a s TypeScript Tipovima | Music Streaming Service",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Music Streaming Service Help"
}</script><!-- End Schema.org --></head><body data-id="Empty-MD-Topic" data-main-title="Integracija Supabase-a s TypeScript Tipovima" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Music Streaming Service  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Empty-MD-Topic" id="Empty-MD-Topic.md">Integracija Supabase-a s TypeScript Tipovima</h1><section class="chapter"><h2 id="korak-1-instalacija-supabase-cli-a" data-toc="korak-1-instalacija-supabase-cli-a">Korak 1: Instalacija Supabase CLI-a</h2><p id="-fwnze9_2006">Za početak, instaliran je Supabase CLI alat kao razvojna zavisnost. Ovaj alat pomaže u generisanju TypeScript tipova iz PostgreSQL &scaron;eme.</p><div class="code-block" data-lang="bash">
npm i supabase@&quot;&gt;=1.8.1&quot; --save-dev
</div><p id="-fwnze9_2008">Obja&scaron;njenje</p><ul class="list _bullet" id="-fwnze9_2009"><li class="list__item" id="-fwnze9_2010"><p><code class="code" id="-fwnze9_2011">npm i supabase@&quot;&gt;=1.8.1&quot; --save-dev</code>: Instalira se Supabase CLI paket s verzijom većom ili jednakom 1.8.1 kao razvojna zavisnost. <code class="code" id="-fwnze9_2012">--save-dev</code> flag osigurava da se koristi samo u razvoju.</p></li></ul></section><section class="chapter"><h2 id="korak-2-prijava-u-supabase" data-toc="korak-2-prijava-u-supabase">Korak 2: Prijava u Supabase</h2><p id="-fwnze9_2013">Potrebno je prijaviti se u Supabase kako bi se generisali tipovi. Ovo zahtijeva token za pristup, koji se može generisati sa stranice postavki Supabase projekta.</p><div class="code-block" data-lang="bash">
npx supabase login
</div><p id="-fwnze9_2015">Obja&scaron;njenje</p><ul class="list _bullet" id="-fwnze9_2016"><li class="list__item" id="-fwnze9_2017"><p><code class="code" id="-fwnze9_2018">npx supabase login</code>: Poziva se unos Supabase tokena za pristup, autentifikujući sesiju i omogućavajući pristup projektu.</p></li></ul></section><section class="chapter"><h2 id="korak-3-generisanje-typescript-tipova" data-toc="korak-3-generisanje-typescript-tipova">Korak 3: Generisanje TypeScript tipova</h2><p id="-fwnze9_2019">Sa prijavljenim CLI-jem, generisani su TypeScript tipovi na osnovu PostgreSQL &scaron;eme.</p><div class="code-block" data-lang="bash">
npx supabase gen types typescript --project-id &quot;$PROJECT_REF&quot; --schema public &gt; types_db.ts
</div><p id="-fwnze9_2021">Obja&scaron;njenje</p><ul class="list _bullet" id="-fwnze9_2022"><li class="list__item" id="-fwnze9_2023"><p><code class="code" id="-fwnze9_2024">npx supabase gen types typescript</code>: Pokreće se Supabase CLI za generisanje TypeScript tipova.</p></li><li class="list__item" id="-fwnze9_2025"><p><code class="code" id="-fwnze9_2026">--project-id &quot;$PROJECT_REF&quot;</code>: Specifikuje ID Supabase projekta.</p></li><li class="list__item" id="-fwnze9_2027"><p><code class="code" id="-fwnze9_2028">--schema public</code>: Ukazuje na &scaron;emu za koju se generi&scaron;u tipovi, u ovom slučaju <code class="code" id="-fwnze9_2029">public</code> &scaron;ema.</p></li><li class="list__item" id="-fwnze9_2030"><p><code class="code" id="-fwnze9_2031">&gt; types_db.ts</code>: Preusmjerava generisane tipove u fajl pod imenom <code class="code" id="-fwnze9_2032">types_db.ts</code>.</p></li></ul><p id="-fwnze9_2033">Nakon ovog koraka, <code class="code" id="-fwnze9_2034">types_db.ts</code> fajl će sadržavati TypeScript tipove za tabele i kolone iz PostgreSQL &scaron;eme.</p><p id="-fwnze9_2035">Link do <a href="https://github.com/SafetImamovic/MusicStreamingService/blob/168a6be7bd7ed5989d6ef8bbeea168ac2756eb42/types_db.ts" id="-fwnze9_2036" data-external="true" rel="noopener noreferrer">types_db.ts</a></p></section><section class="chapter"><h2 id="korak-4-postavljanje-supabase-i-user-context-providera" data-toc="korak-4-postavljanje-supabase-i-user-context-providera">Korak 4: Postavljanje Supabase i User Context Providera</h2><section class="chapter"><h3 id="4-1-kreiranje-direktorija-i-fajla" data-toc="4-1-kreiranje-direktorija-i-fajla">4.1: Kreiranje direktorija i fajla</h3><p id="-fwnze9_2037">Kreiran je direktorij pod nazivom <code class="code" id="-fwnze9_2038">providers</code> i fajl pod nazivom <code class="code" id="-fwnze9_2039">SupabaseProvider.tsx</code> u Next.js projektu.</p><div class="code-block" data-lang="bash">
mkdir providers
touch providers/SupabaseProvider.tsx
</div></section><section class="chapter"><h3 id="4-2-instalacija-supabase-auth-helpers" data-toc="4-2-instalacija-supabase-auth-helpers">4.2: Instalacija Supabase Auth Helpers</h3><p id="-fwnze9_2041">Instalirani su potrebni paketi za upravljanje Supabase autentifikacijom u Next.js i React.</p><div class="code-block" data-lang="bash">
npm install @supabase/auth-helpers-nextjs @supabase/auth-helpers-react
</div></section><section class="chapter"><h3 id="4-3-implementacija-supabaseprovider" data-toc="4-3-implementacija-supabaseprovider">4.3: Implementacija SupabaseProvider</h3><p id="-fwnze9_2043">Sljedeći kod je dodan u <code class="code" id="-fwnze9_2044">SupabaseProvider.tsx</code> kako bi se kreirao Supabase klijent i obezbijedio kontekst sesije.</p><div class="code-block" data-lang="ts">
&quot;use client&quot;;

import { createClientComponentClient } from &quot;@supabase/auth-helpers-nextjs&quot;;
import { SessionContextProvider } from &quot;@supabase/auth-helpers-react&quot;;
import { useState } from &quot;react&quot;;
import { Database } from &quot;@/types_db&quot;;

interface SupabaseProviderProps {
  children: React.ReactNode;
}

const SupabaseProvider: React.FC&lt;SupabaseProviderProps&gt; = ({ children }) =&gt; {
  const [supabaseClient] = useState(() =&gt; createClientComponentClient&lt;Database&gt;());

  return (
    &lt;SessionContextProvider supabaseClient={supabaseClient}&gt;
      {children}
    &lt;/SessionContextProvider&gt;
  );
};

export default SupabaseProvider;
</div></section><section class="chapter"><h3 id="4-4-omotavanje-glavnog-layouta-sa-supabaseprovider" data-toc="4-4-omotavanje-glavnog-layouta-sa-supabaseprovider">4.4: Omotavanje glavnog layouta sa SupabaseProvider</h3><p id="-fwnze9_2046"><code class="code" id="-fwnze9_2047">layout.tsx</code> je izmijenjen kako bi uključio <code class="code" id="-fwnze9_2048">SupabaseProvider</code>.</p><div class="code-block" data-lang="ts">
import type { Metadata } from &quot;next&quot;;
import { Figtree } from &quot;next/font/google&quot;;
import &quot;./globals.css&quot;;
import Sidebar from &quot;@/components/Sidebar&quot;;
import SupabaseProvider from &quot;@/providers/SupabaseProvider&quot;;

const inter = Figtree({ subsets: [&quot;latin&quot;] });

export const metadata: Metadata = {
  title: &quot;Music Streaming Service&quot;,
  description: &quot;Listen to the BEST song!&quot;,
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body className={inter.className}&gt;
        &lt;SupabaseProvider&gt;
          &lt;Sidebar&gt;
            {children}
          &lt;/Sidebar&gt;
        &lt;/SupabaseProvider&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}
</div></section></section><section class="chapter"><h2 id="korak-5-postavljanje-user-context-a" data-toc="korak-5-postavljanje-user-context-a">Korak 5: Postavljanje User Context-a</h2><section class="chapter"><h3 id="5-1-kreiranje-direktorija-i-fajlova-za-hookove" data-toc="5-1-kreiranje-direktorija-i-fajlova-za-hookove">5.1: Kreiranje direktorija i fajlova za hookove</h3><p id="-fwnze9_2050">Kreiran je direktorij <code class="code" id="-fwnze9_2051">hooks</code> i fajl <code class="code" id="-fwnze9_2052">useUser.tsx</code>.</p><div class="code-block" data-lang="bash">
mkdir hooks
touch hooks/useUser.tsx
</div></section><section class="chapter"><h3 id="5-2-definisanje-tipova-korisnika" data-toc="5-2-definisanje-tipova-korisnika">5.2: Definisanje tipova korisnika</h3><p id="-fwnze9_2054">Novi fajl <code class="code" id="-fwnze9_2055">types.ts</code> je dodat u korijenu projekta kako bi se definisali TypeScript tipovi za detalje korisnika, proizvode, cijene i pretplate.</p><div class="code-block" data-lang="ts">
import Stripe from &quot;stripe&quot;;

export interface UserDetails {
  id: string;
  first_name: string;
  last_name: string;
  full_name?: string;
  avatar_url?: string;
  billing_address?: Stripe.Address;
  payment_method?: Stripe.PaymentMethod[Stripe.PaymentMethod.Type];
}

export interface Product {
  id: string;
  active?: boolean;
  name?: string;
  description?: string;
  image?: string;
  metadata: Stripe.Metadata;
}

export interface Price {
  id: string;
  product_id?: string;
  active?: boolean;
  description?: string;
  unit_amount?: number;
  currency?: string;
  type?: Stripe.Price.Type;
  interval?: Stripe.Price.Recurring.Interval;
  interval_count?: number;
  trial_period_days?: number | null;
  metadata?: Stripe.Metadata;
  products?: Product;
}

export interface Subscription {
  id: string;
  user_id: string;
  status?: Stripe.Subscription.Status;
  metadata?: Stripe.Metadata;
  price_id?: string;
  quantity?: number;
  cancel_at_period_end?: boolean;
  created: string;
  current_period_start: string;
  current_period_end: string;
  ended_at?: string;
  cancel_at?: string;
  canceled_at?: string;
  trial_start?: string;
  trial_end?: string;
  prices?: Price;
}
</div></section><section class="chapter"><h3 id="5-3-implementacija-useuser-hook-a" data-toc="5-3-implementacija-useuser-hook-a">5.3: Implementacija useUser hook-a</h3><p id="-fwnze9_2057">Sljedeći kod je dodat u <code class="code" id="-fwnze9_2058">useUser.tsx</code> kako bi se upravljalo korisničkim kontekstom i detaljima pretplate.</p><div class="code-block" data-lang="ts">
import { Subscription, UserDetails } from &quot;@/types&quot;;
import { User } from &quot;@supabase/auth-helpers-nextjs&quot;;
import { createContext, useContext, useEffect, useState } from &quot;react&quot;;
import { useSessionContext, useUser as useSupaUser } from &quot;@supabase/auth-helpers-react&quot;;

type UserContextType = {
  accessToken: string | null;
  user: User | null;
  userDetails: UserDetails | null;
  isLoading: boolean;
  subscription: Subscription | null;
};

export const UserContext = createContext&lt;UserContextType | undefined&gt;(undefined);

export interface Props {
  [propName: string]: any;
}

export const MyUserContextProvider = (props: Props) =&gt; {
  const { session, isLoading: isLoadingUser, supabaseClient: supabase } = useSessionContext();
  const user = useSupaUser();
  const accessToken = session?.access_token ?? null;
  const [isLoadingData, setIsLoadingData] = useState(false);
  const [userDetails, setUserDetails] = useState&lt;UserDetails | null&gt;(null);
  const [subscription, setSubscription] = useState&lt;Subscription | null&gt;(null);

  const getUserDetails = () =&gt; supabase.from('users').select('*').single();
  const getSubscription = () =&gt;
    supabase.from(&quot;subscriptions&quot;)
      .select('*, prices(*, products(*))')
      .in('status', ['trialing', 'active'])
      .single();

  useEffect(() =&gt; {
    if (user &amp;&amp; !isLoadingData &amp;&amp; !userDetails &amp;&amp; !subscription) {
      setIsLoadingData(true);

      Promise.allSettled([getUserDetails(), getSubscription()]).then((results) =&gt; {
        const userDetailsPromise = results[0];
        const subscriptionPromise = results[1];

        if (userDetailsPromise.status === &quot;fulfilled&quot;) {
          setUserDetails(userDetailsPromise.value.data as UserDetails);
        }

        if (subscriptionPromise.status === &quot;fulfilled&quot;) {
          setSubscription(subscriptionPromise.value.data as Subscription);
        }

        setIsLoadingData(false);
      });
    } else if (!user &amp;&amp; !isLoadingUser &amp;&amp; !isLoadingData) {
      setUserDetails(null);
      setSubscription(null);
    }
  }, [user, isLoadingUser]);

  const value = {
    accessToken,
    user,
    userDetails,
    isLoading: isLoadingUser || isLoadingData,
    subscription,
  };

  return &lt;UserContext.Provider value={value} {...props} /&gt;;
};

export const useUser = () =&gt; {
  const context = useContext(UserContext);
  if (context === undefined) {


    throw new Error('useUser must be used within a MyUserContextProvider');
  }
  return context;
};
</div></section><section class="chapter"><h3 id="5-4-kreiranje-userprovider-a" data-toc="5-4-kreiranje-userprovider-a">5.4: Kreiranje UserProvider-a</h3><p id="-fwnze9_2060">Kreiran je fajl <code class="code" id="-fwnze9_2061">UserProvider.tsx</code> u <code class="code" id="-fwnze9_2062">providers</code> direktoriju i dodan sljedeći kod.</p><div class="code-block" data-lang="ts">
&quot;use client&quot;;

import { MyUserContextProvider } from &quot;@/hooks/useUser&quot;;

interface UserProviderProps {
  children: React.ReactNode;
}

const UserProvider: React.FC&lt;UserProviderProps&gt; = ({ children }) =&gt; {
  return (
    &lt;MyUserContextProvider&gt;
      {children}
    &lt;/MyUserContextProvider&gt;
  );
};

export default UserProvider;
</div></section><section class="chapter"><h3 id="5-5-omotavanje-layouta-sa-userprovider-om" data-toc="5-5-omotavanje-layouta-sa-userprovider-om">5.5: Omotavanje layouta sa UserProvider-om</h3><p id="-fwnze9_2064"><code class="code" id="-fwnze9_2065">layout.tsx</code> je izmijenjen kako bi uključio <code class="code" id="-fwnze9_2066">UserProvider</code>.</p><div class="code-block" data-lang="ts">
import type { Metadata } from &quot;next&quot;;
import { Figtree } from &quot;next/font/google&quot;;
import &quot;./globals.css&quot;;
import Sidebar from &quot;@/components/Sidebar&quot;;
import SupabaseProvider from &quot;@/providers/SupabaseProvider&quot;;
import UserProvider from &quot;@/providers/UserProvider&quot;;

const inter = Figtree({ subsets: [&quot;latin&quot;] });

export const metadata: Metadata = {
  title: &quot;Music Streaming Service&quot;,
  description: &quot;Listen to the BEST song!&quot;,
};

export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    &lt;html lang=&quot;en&quot;&gt;
      &lt;body className={inter.className}&gt;
        &lt;SupabaseProvider&gt;
          &lt;UserProvider&gt;
            &lt;Sidebar&gt;
              {children}
            &lt;/Sidebar&gt;
          &lt;/UserProvider&gt;
        &lt;/SupabaseProvider&gt;
      &lt;/body&gt;
    &lt;/html&gt;
  );
}
</div></section></section><section class="chapter"><h2 id="korak-6-instalacija-stripe-a" data-toc="korak-6-instalacija-stripe-a">Korak 6: Instalacija Stripe-a</h2><p id="-fwnze9_2068">Instalirana je Stripe biblioteka za upravljanje podacima vezanim za Stripe.</p><div class="code-block" data-lang="bash">
npm i stripe
</div></section><div class="last-modified">Last modified: 18 May 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="supabase-postavke.html" class="navigation-links__prev">Supabase Postavke</a><a href="napomene.html" class="navigation-links__next">Napomene</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.js"></script></body></html>