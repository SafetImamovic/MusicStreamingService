<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2024-05-18T23:08:35.6217616"><title>Supabase Postavke | Music Streaming Service</title><script type="application/json" id="virtual-toc-data">[{"id":"kreiranje-ra-una","level":0,"title":"Kreiranje Računa","anchor":"#kreiranje-ra-una"},{"id":"postavke-projekta","level":0,"title":"Postavke Projekta","anchor":"#postavke-projekta"},{"id":"api-klju-evi","level":0,"title":"API Ključevi","anchor":"#api-klju-evi"},{"id":"ema-baze-podataka","level":0,"title":"Šema Baze Podataka","anchor":"#ema-baze-podataka"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Supabase Postavke | Music Streaming Service"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Music Streaming Service Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/supabase-postavke.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Supabase Postavke | Music Streaming Service"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/supabase-postavke.html#webpage",
    "url": "writerside-documentation/supabase-postavke.html",
    "name": "Supabase Postavke | Music Streaming Service",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Music Streaming Service Help"
}</script><!-- End Schema.org --></head><body data-id="Supabase-Postavke" data-main-title="Supabase Postavke" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs="Baza-Podataka.md|Baza Podataka"><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Music Streaming Service  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Supabase-Postavke" id="Supabase-Postavke.md">Supabase Postavke</h1><section class="chapter"><h2 id="kreiranje-ra-una" data-toc="kreiranje-ra-una">Kreiranje Računa</h2><ol class="list _decimal" id="mfn0pj_2" type="1"><li class="list__item" id="mfn0pj_3"><p><span class="control" id="mfn0pj_4">Kreiranje Supabase računa putem GitHub-a</span></p><ul class="list _bullet" id="mfn0pj_5"><li class="list__item" id="mfn0pj_6"><p>Registracija na Supabase koristeći GitHub račun.</p></li></ul></li></ol></section><section class="chapter"><h2 id="postavke-projekta" data-toc="postavke-projekta">Postavke Projekta</h2><ol class="list _decimal" id="mfn0pj_7" type="1"><li class="list__item" id="mfn0pj_8"><p id="mfn0pj_9"><span class="control" id="mfn0pj_10">Postavke projekta</span></p><ul class="list _bullet" id="mfn0pj_11"><li class="list__item" id="mfn0pj_12"><p>Naziv projekta: <code class="code" id="mfn0pj_13">MusicStreamingService</code></p></li><li class="list__item" id="mfn0pj_14"><p>Region: Frankfurt, EU (lokacija servera)</p></li></ul></li><li class="list__item" id="mfn0pj_15"><p id="mfn0pj_16"><span class="control" id="mfn0pj_17">Lozinka projekta</span></p><ul class="list _bullet" id="mfn0pj_18"><li class="list__item" id="mfn0pj_19"><p>Generisana je lozinka za projekat i kopirana je u <code class="code" id="mfn0pj_20">password.txt</code> u korijenu projekta.</p></li><li class="list__item" id="mfn0pj_21"><p>Dodano je <code class="code" id="mfn0pj_22">password.txt</code> u <code class="code" id="mfn0pj_23">.gitignore</code> kako bi se osiguralo da se ne po&scaron;alje u repozitorij.</p></li></ul></li></ol></section><section class="chapter"><h2 id="api-klju-evi" data-toc="api-klju-evi">API Ključevi</h2><ol class="list _decimal" id="mfn0pj_24" type="1"><li class="list__item" id="mfn0pj_25"><p><span class="control" id="mfn0pj_26">Postavke API ključeva</span></p><ul class="list _bullet" id="mfn0pj_27"><li class="list__item" id="mfn0pj_28"><p>U postavkama Supabase -&gt; API.</p></li><li class="list__item" id="mfn0pj_29"><p>Prikupljeno je sljedeće: </p><ul class="list _bullet" id="mfn0pj_30"><li class="list__item" id="mfn0pj_31"><p><code class="code" id="mfn0pj_32">NEXT_PUBLIC_SUPABASE_URL</code></p></li><li class="list__item" id="mfn0pj_33"><p><code class="code" id="mfn0pj_34">NEXT_PUBLIC_SUPABASE_ANON_KEY</code></p></li><li class="list__item" id="mfn0pj_35"><p><code class="code" id="mfn0pj_36">SUPABASE_SERVICE_ROLE_KEY</code></p></li></ul></li><li class="list__item" id="mfn0pj_37"><p>Dodano je ovo u <code class="code" id="mfn0pj_38">.env.local</code> datoteku.</p></li><li class="list__item" id="mfn0pj_39"><p>Osigurajte da je <code class="code" id="mfn0pj_40">.env.local</code> dodan u <code class="code" id="mfn0pj_41">.gitignore</code>.</p></li></ul></li></ol><aside class="prompt" data-type="tip" data-title="" id="mfn0pj_42"><p id="mfn0pj_43">Napomena <span class="control" id="mfn0pj_44">Obja&scaron;njenje API ključeva:</span></p><ul class="list _bullet" id="mfn0pj_45"><li class="list__item" id="mfn0pj_46"><p><span class="control" id="mfn0pj_47">NEXT_PUBLIC_SUPABASE_URL</span>: URL va&scaron;e Supabase instance.</p></li><li class="list__item" id="mfn0pj_48"><p><span class="control" id="mfn0pj_49">NEXT_PUBLIC_SUPABASE_ANON_KEY</span>: Anonimni ključ za javni pristup.</p></li><li class="list__item" id="mfn0pj_50"><p><span class="control" id="mfn0pj_51">SUPABASE_SERVICE_ROLE_KEY</span>: Ključ sa povi&scaron;enim ovla&scaron;tenjima za server-side operacije.</p></li></ul></aside></section><section class="chapter"><h2 id="ema-baze-podataka" data-toc="ema-baze-podataka">&Scaron;ema Baze Podataka</h2><section class="chapter"><h3 id="brzi-start-abloni" data-toc="brzi-start-abloni">Brzi Start &Scaron;abloni</h3><ol class="list _decimal" id="mfn0pj_52" type="1"><li class="list__item" id="mfn0pj_53"><p><span class="control" id="mfn0pj_54">Stripe Pretplate &Scaron;ablon</span></p></li></ol><div class="code-block" data-lang="sql">
-- TABELA USERS
create table users (
  id uuid references auth.users not null primary key,
  full_name text,
  avatar_url text,
  billing_address jsonb,
  payment_method jsonb
);
alter table users enable row level security;
create policy &quot;Can view own user data.&quot; on users
  for select using ((select auth.uid()) = id);
create policy &quot;Can update own user data.&quot; on users
  for update using ((select auth.uid()) = id);

-- TRIGGER ZA NOVE KORISNIKE
create function public.handle_new_user()
returns trigger as
$$
  begin
    insert into public.users (id, full_name, avatar_url)
    values (new.id, new.raw_user_meta_data-&gt;&gt;'full_name', new.raw_user_meta_data-&gt;&gt;'avatar_url');
    return new;
  end;
$$
language plpgsql security definer;
create trigger on_auth_user_created
  after insert on auth.users
  for each row
  execute procedure public.handle_new_user();

-- TABELA CUSTOMERS
create table customers (
  id uuid references auth.users not null primary key,
  stripe_customer_id text
);
alter table customers enable row level security;

-- TABELA PRODUCTS
create table products (
  id text primary key,
  active boolean,
  name text,
  description text,
  image text,
  metadata jsonb
);
alter table products enable row level security;
create policy &quot;Allow public read-only access.&quot; on products
  for select using (true);

-- TABELA PRICES
create type pricing_type as enum ('one_time', 'recurring');
create type pricing_plan_interval as enum ('day', 'week', 'month', 'year');
create table prices (
  id text primary key,
  product_id text references products,
  active boolean,
  description text,
  unit_amount bigint,
  currency text check (char_length(currency) = 3),
  type pricing_type,
  interval pricing_plan_interval,
  interval_count integer,
  trial_period_days integer,
  metadata jsonb
);
alter table prices enable row level security;
create policy &quot;Allow public read-only access.&quot; on prices
  for select using (true);

-- TABELA SUBSCRIPTIONS
create type subscription_status as enum ('trialing', 'active', 'canceled', 'incomplete', 'incomplete_expired', 'past_due', 'unpaid');
create table subscriptions (
  id text primary key,
  user_id uuid references auth.users not null,
  status subscription_status,
  metadata jsonb,
  price_id text references prices,
  quantity integer,
  cancel_at_period_end boolean,
  created timestamp with time zone default timezone('utc'::text, now()) not null,
  current_period_start timestamp with time zone default timezone('utc'::text, now()) not null,
  current_period_end timestamp with time zone default timezone('utc'::text, now()) not null,
  ended_at timestamp with time zone default timezone('utc'::text, now()),
  cancel_at timestamp with time zone default timezone('utc'::text, now()),
  canceled_at timestamp with time zone default timezone('utc'::text, now()),
  trial_start timestamp with time zone default timezone('utc'::text, now()),
  trial_end timestamp with time zone default timezone('utc'::text, now())
);
alter table subscriptions enable row level security;
create policy &quot;Can only view own subs data.&quot; on subscriptions
  for select using ((select auth.uid()) = user_id);

-- REALTIME PRETPLATE
drop publication if exists supabase_realtime;
create publication supabase_realtime for table products, prices;
</div><figure id="mfn0pj_56"><img alt="1 tables created" src="images/1-Tables-Created.png" title="1 tables created" width="561" height="609"></figure><aside class="prompt" data-type="tip" data-title="" id="mfn0pj_57"><p id="mfn0pj_58">Napomena <span class="control" id="mfn0pj_59">Obja&scaron;njenje SQL Koda:</span></p><ul class="list _bullet" id="mfn0pj_60"><li class="list__item" id="mfn0pj_61"><p><span class="control" id="mfn0pj_62">Users Tabela:</span> Čuva podatke o korisnicima sa sigurno&scaron;ću na nivou reda kako bi se osiguralo da korisnici mogu pregledati i ažurirati samo svoje podatke.</p></li><li class="list__item" id="mfn0pj_63"><p><span class="control" id="mfn0pj_64">Trigger za nove korisnike:</span> Automatski kreira unos u <code class="code" id="mfn0pj_65">users</code> tabeli kada se novi korisnik registruje.</p></li><li class="list__item" id="mfn0pj_66"><p><span class="control" id="mfn0pj_67">Customers Tabela:</span> Povezuje ID korisnika sa Stripe ID-om korisnika, nije dostupno korisnicima.</p></li><li class="list__item" id="mfn0pj_68"><p><span class="control" id="mfn0pj_69">Products Tabela:</span> Čuva detalje o proizvodima, dostupno svima u read-only načinu.</p></li><li class="list__item" id="mfn0pj_70"><p><span class="control" id="mfn0pj_71">Prices Tabela:</span> Čuva detalje o cijenama, sinhronizovano sa Stripe-om, dostupno svima u read-only načinu.</p></li><li class="list__item" id="mfn0pj_72"><p><span class="control" id="mfn0pj_73">Subscriptions Tabela:</span> Čuva detalje o pretplatama, osiguravajući da korisnici mogu pregledati samo svoje pretplate.</p></li><li class="list__item" id="mfn0pj_74"><p><span class="control" id="mfn0pj_75">Realtime Pretplate:</span> Omogućava real-time praćenje na javnim tabelama <code class="code" id="mfn0pj_76">products</code> i <code class="code" id="mfn0pj_77">prices</code>.</p></li></ul></aside></section><section class="chapter"><h3 id="dodatne-tabele-i-politike" data-toc="dodatne-tabele-i-politike">Dodatne Tabele i Politike</h3><ol class="list _decimal" id="mfn0pj_78" type="1"><li class="list__item" id="mfn0pj_79"><p><span class="control" id="mfn0pj_80">Tracks Tabela</span></p></li></ol><figure id="mfn0pj_81"><img alt="2 table policies" src="images/2-Table-Policies.png" title="2 table policies" width="1354" height="617"></figure><div class="code-block" data-lang="sql">
create table public.tracks (
  id bigint generated by default as identity,
  created_at timestamp with time zone not null default now(),
  title text null,
  track_path text null,
  image_path text null,
  gif_path text null,
  author
  text null,
  user_id uuid null,
  constraint tracks_pkey primary key (id),
  constraint tracks_user_id_fkey foreign key (user_id) references users (id) on delete cascade
) tablespace pg_default;
</div><ol class="list _decimal" id="mfn0pj_83" type="1" start="2"><li class="list__item" id="mfn0pj_84"><p><span class="control" id="mfn0pj_85">Politike za Tracks Tabelu</span></p></li></ol><div class="code-block" data-lang="sql">
alter policy &quot;Omogući čitanje svim korisnicima&quot; on &quot;public&quot;.&quot;tracks&quot; to public using (true);
create policy &quot;Omogući unos samo autentificiranim korisnicima&quot; on &quot;public&quot;.&quot;tracks&quot; as PERMISSIVE for INSERT to authenticated with check (true);
</div><ol class="list _decimal" id="mfn0pj_87" type="1" start="3"><li class="list__item" id="mfn0pj_88"><p><span class="control" id="mfn0pj_89">Tabela Liked Tracks</span></p></li></ol><div class="code-block" data-lang="sql">
create table public.liked_tracks (
  user_id uuid not null,
  created_at timestamp with time zone not null default now(),
  track_id bigint not null,
  constraint liked_tracks_pkey primary key (user_id, track_id),
  constraint liked_tracks_track_id_fkey foreign key (track_id) references tracks (id) on delete cascade,
  constraint liked_tracks_user_id_fkey foreign key (user_id) references users (id) on delete cascade
) tablespace pg_default;
</div><ol class="list _decimal" id="mfn0pj_91" type="1" start="4"><li class="list__item" id="mfn0pj_92"><p><span class="control" id="mfn0pj_93">Politike Tabele Omiljenih Pjesama</span></p></li></ol><figure id="mfn0pj_94"><img alt="3 bucket policies" src="images/3-Bucket-Policies.png" title="3 bucket policies" width="1331" height="818"></figure><div class="code-block" data-lang="sql">
alter policy &quot;Dozvoli brisanje korisnicima na osnovu user_id&quot; na &quot;public&quot;.&quot;liked_tracks&quot; za javno korištenje (((SELECT auth.uid() AS uid) = user_id));
</div><ol class="list _decimal" id="mfn0pj_96" type="1" start="5"><li class="list__item" id="mfn0pj_97"><p id="mfn0pj_98"><span class="control" id="mfn0pj_99">Postavljanje Skladi&scaron;ta</span></p></li><li class="list__item" id="mfn0pj_100"><p id="mfn0pj_101"><span class="control" id="mfn0pj_102">Kreiranje Kanti</span></p><ul class="list _bullet" id="mfn0pj_103"><li class="list__item" id="mfn0pj_104"><p><span class="control" id="mfn0pj_105">Kanta za Pjesme:</span> Ograničena na audio/mpeg.</p></li><li class="list__item" id="mfn0pj_106"><p><span class="control" id="mfn0pj_107">Kante za Slike i GIF-ove:</span> Nema ograničenja tipova.</p></li></ul></li><li class="list__item" id="mfn0pj_108"><p id="mfn0pj_109"><span class="control" id="mfn0pj_110">Politike Skladi&scaron;ta za Kantu za Pjesme</span></p></li></ol><figure id="mfn0pj_111"><img alt="Liked tracks rls policies" src="images/Liked-Tracks-RLS-Policies.png" title="Liked tracks rls policies" width="1348" height="676"></figure><div class="code-block" data-lang="sql">
CREATE POLICY &quot;Dozvoli sve 1kpor60 0&quot; NA storage.objects ZA SELECT ZA public KORIŠTENJEM (bucket_id = 'pjesme');
CREATE POLICY &quot;Dozvoli sve 1kpor60 1&quot; NA storage.objects ZA INSERT ZA public SA PROVJEROM (bucket_id = 'pjesme');
CREATE POLICY &quot;Dozvoli sve 1kpor60 2&quot; NA storage.objects ZA UPDATE ZA public KORIŠTENJEM (bucket_id = 'pjesme');
CREATE POLICY &quot;Dozvoli sve 1kpor60 3&quot; NA storage.objects ZA DELETE ZA public KORIŠTENJEM (bucket_id = 'pjesme');
</div></section></section><div class="last-modified">Last modified: 18 May 2024</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="baza-podataka.html" class="navigation-links__prev">Baza Podataka</a><a href="empty-md-topic.html" class="navigation-links__next">Integracija Supabase-a s TypeScript Tipovima</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b259/app.js"></script></body></html>